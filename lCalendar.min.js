/*
 * 日期控件
 * 
 * 作者：黄磊
 * 
 * 邮箱：xfhxbb@yeah.net
 * 
 * Copyright 2016
 * 
 * 创建于：2016-01-08
 */
function editDate(a){if(hlCalendar.listener=a.target,hlCalendar.gearDate=document.querySelector(".gearDate"),hlCalendar.gearDate||(hlCalendar.gearDate=document.createElement("div"),hlCalendar.gearDate.className="gearDate",hlCalendar.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn" onclick="cancelDateEdit();">取消</div><div class="date_btn" onclick="finishDateEdit();">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>日</div></div></div></div></div></div>',document.body.appendChild(hlCalendar.gearDate)),null!=hlCalendar.listener.getAttribute("data-hl-calendar")){var b=hlCalendar.listener.getAttribute("data-hl-calendar").split(","),c=b[0],d=c.split("-");hlCalendar.params.minY=~~d[0],hlCalendar.params.minM=~~d[1],hlCalendar.params.minD=~~d[2];var e=b[1],f=e.split("-");hlCalendar.params.maxY=~~f[0],passY=hlCalendar.params.maxY-hlCalendar.params.minY+1,hlCalendar.params.maxM=~~f[1],hlCalendar.params.maxD=~~f[2]}dateCtrlInit(),hlCalendar.gearDate.style.display&&"none"!=hlCalendar.gearDate.style.display||(hlCalendar.gearDate.style.display="block")}function dateCtrlInit(){var a=new Date,b={yy:a.getYear(),mm:a.getMonth(),dd:a.getDate()-1};/^\d{4}-\d{1,2}-\d{1,2}$/.test(hlCalendar.listener.value)?(rs=hlCalendar.listener.value.match(/(^|-)\d{1,4}/g),b.yy=rs[0]-hlCalendar.params.minY,b.mm=rs[1].replace(/-/g,"")-1,b.dd=rs[2].replace(/-/g,"")-1):b.yy=b.yy+1900-hlCalendar.params.minY,hlCalendar.gearDate.querySelector(".date_yy").setAttribute("val",b.yy),hlCalendar.gearDate.querySelector(".date_mm").setAttribute("val",b.mm),hlCalendar.gearDate.querySelector(".date_dd").setAttribute("val",b.dd),setDateGear()}function setDateGear(){var a=hlCalendar.gearDate.querySelector(".date_yy"),b="";if(a&&a.getAttribute("val")){for(var c=parseInt(a.getAttribute("val")),d=0;passY-1>=d;d++)b+="<div class='tooth'>"+(hlCalendar.params.minY+d)+"</div>";a.innerHTML=b;var e=Math.floor(parseFloat(a.style.top));if(isNaN(e))a.style.top=8-2*c+"em";else{e%2==0?e=e:e+=1,e>8&&(e=8);var f=8-2*(passY-1);f>e&&(e=f),a.style.top=e+"em",c=Math.abs(e-8)/2,a.setAttribute("val",c)}var g=hlCalendar.gearDate.querySelector(".date_mm");if(g&&g.getAttribute("val")){b="";var h=parseInt(g.getAttribute("val")),i=12;minM=1,c==passY-1&&(i=hlCalendar.params.maxM),0==c&&(minM=hlCalendar.params.minM);var e=Math.floor(parseFloat(g.style.top));if(isNaN(e))g.style.top=8-2*h+"em";else{e%2==0?e=e:e+=1,e>8&&(e=8);var f=8-2*(i-minM);f>e&&(e=f),g.style.top=e+"em",h=Math.abs(e-8)/2,g.setAttribute("val",h)}for(var d=0;d<i-minM+1;d++)b+="<div class='tooth'>"+(minM+d)+"</div>";g.innerHTML=b;var j=hlCalendar.gearDate.querySelector(".date_dd");if(j&&j.getAttribute("val")){b="";var k=parseInt(j.getAttribute("val")),l=calcDays(c,h),m=l;minD=1,c==passY-1&&hlCalendar.params.maxM==h+1&&(m=hlCalendar.params.maxD),0==c&&0==h&&(minD=hlCalendar.params.minD);var e=Math.floor(parseFloat(j.style.top));if(isNaN(e))j.style.top=8-2*k+"em";else{e%2==0?e=e:e+=1,e>8&&(e=8);var f=8-2*(m-minD);f>e&&(e=f),j.style.top=e+"em",k=Math.abs(e-8)/2,j.setAttribute("val",k)}for(var d=0;d<m-minD+1;d++)b+="<div class='tooth'>"+(minD+d)+"</div>";j.innerHTML=b}}}}function calcDays(a,b){return 1==b?(a+=hlCalendar.params.minY,a%4==0&&a%100!=0||a%400==0&&a%4e3!=0?29:28):3==b||5==b||8==b||10==b?30:31}function editDatetime(a){if(hlCalendar.listener=a.target,hlCalendar.gearDate=document.querySelector(".gearDatetime"),hlCalendar.gearDate||(hlCalendar.gearDate=document.createElement("div"),hlCalendar.gearDate.className="gearDatetime",hlCalendar.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn" onclick="cancelDateEdit();">取消</div><div class="date_btn" onclick="finishDatetimeEdit();">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>日</div></div></div><div><div class="gear time_hh" data-datetype="time_hh" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>分</div></div></div></div></div></div>',document.body.appendChild(hlCalendar.gearDate)),null!=hlCalendar.listener.getAttribute("data-hl-calendar")){var b=hlCalendar.listener.getAttribute("data-hl-calendar").split(","),c=b[0],d=c.split("-");hlCalendar.params.minY=~~d[0],hlCalendar.params.minM=~~d[1],hlCalendar.params.minD=~~d[2];var e=b[1],f=e.split("-");hlCalendar.params.maxY=~~f[0],passY=hlCalendar.params.maxY-hlCalendar.params.minY+1,hlCalendar.params.maxM=~~f[1],hlCalendar.params.maxD=~~f[2]}dateTimeCtrlInit(hlCalendar.gearDate),hlCalendar.gearDate.style.display&&"none"!=hlCalendar.gearDate.style.display||(hlCalendar.gearDate.style.display="block")}function dateTimeCtrlInit(a){var b=new Date,c={yy:b.getYear(),mm:b.getMonth(),dd:b.getDate()-1,hh:b.getHours(),mi:b.getMinutes()};/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(hlCalendar.listener.value)?(rs=hlCalendar.listener.value.match(/(^|-|\s|:)\d{1,4}/g),c.yy=rs[0]-hlCalendar.params.minY,c.mm=rs[1].replace(/-/g,"")-1,c.dd=rs[2].replace(/-/g,"")-1,c.hh=parseInt(rs[3].replace(/\s0?/g,"")),c.mi=parseInt(rs[4].replace(/:0?/g,""))):c.yy=c.yy+1900-hlCalendar.params.minY,a.querySelector(".date_yy").setAttribute("val",c.yy),a.querySelector(".date_mm").setAttribute("val",c.mm),a.querySelector(".date_dd").setAttribute("val",c.dd),setDateGear(),a.querySelector(".time_hh").setAttribute("val",c.hh),a.querySelector(".time_mm").setAttribute("val",c.mi),setTimeGear(a)}function editTime(a){hlCalendar.listener=a.target,hlCalendar.gearDate=document.querySelector(".gearTime"),hlCalendar.gearDate||(hlCalendar.gearDate=document.createElement("div"),hlCalendar.gearDate.className="gearDate",hlCalendar.gearDate.innerHTML='<div class="time_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn" onclick="cancelDateEdit();">取消</div><div class="date_btn" onclick="finishTimeEdit();">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>分</div></div></div></div></div></div>',document.body.appendChild(hlCalendar.gearDate)),timeCtrlInit(hlCalendar.gearDate),hlCalendar.gearDate.style.display&&"none"!=hlCalendar.gearDate.style.display||(hlCalendar.gearDate.style.display="block")}function timeCtrlInit(a){var b=new Date,c={hh:b.getHours(),mm:b.getMinutes()};/^\d{2}:\d{2}$/.test(hlCalendar.listener.value)&&(rs=hlCalendar.listener.value.match(/(^|:)\d{2}/g),c.hh=parseInt(rs[0].replace(/^0?/g,"")),c.mm=parseInt(rs[1].replace(/:0?/g,""))),a.querySelector(".time_hh").setAttribute("val",c.hh),a.querySelector(".time_mm").setAttribute("val",c.mm),setTimeGear(a)}function setTimeGear(a){var b=a.querySelector(".time_hh");if(b&&b.getAttribute("val")){var c="",d=parseInt(b.getAttribute("val"));b.style.top=8-2*d+"em";for(var e=0;23>=e;e++)c+="<div class='tooth'>"+e+"</div>";b.innerHTML=c;var f=a.querySelector(".time_mm");if(f&&f.getAttribute("val")){var c="",g=parseInt(f.getAttribute("val"));f.style.top=8-2*g+"em";for(var e=0;59>=e;e++)c+="<div class='tooth'>"+e+"</div>";f.innerHTML=c}}}function cancelDateEdit(){var a=new CustomEvent("input");hlCalendar.listener.dispatchEvent(a),document.body.removeChild(hlCalendar.gearDate)}function finishDateEdit(){var a=parseInt(hlCalendar.gearDate.querySelector(".date_yy").getAttribute("val")),b=parseInt(hlCalendar.gearDate.querySelector(".date_mm").getAttribute("val"))+minM;b=b>9?b:"0"+b;var c=parseInt(hlCalendar.gearDate.querySelector(".date_dd").getAttribute("val"))+minD;c=c>9?c:"0"+c,hlCalendar.listener.value=a%passY+hlCalendar.params.minY+"-"+b+"-"+c,cancelDateEdit()}function finishDatetimeEdit(){var a=parseInt(hlCalendar.gearDate.querySelector(".date_yy").getAttribute("val")),b=parseInt(hlCalendar.gearDate.querySelector(".date_mm").getAttribute("val"))+minM;b=b>9?b:"0"+b;var c=parseInt(hlCalendar.gearDate.querySelector(".date_dd").getAttribute("val"))+minD;c=c>9?c:"0"+c;var d=hlCalendar.gearDate.querySelector(".time_hh").getAttribute("val"),e=hlCalendar.gearDate.querySelector(".time_mm").getAttribute("val");hlCalendar.listener.value=a%passY+hlCalendar.params.minY+"-"+b+"-"+c+" "+(d.length<2?"0":"")+d+(e.length<2?":0":":")+e,cancelDateEdit()}function finishTimeEdit(){var a=hlCalendar.gearDate.querySelector(".time_hh").getAttribute("val"),b=hlCalendar.gearDate.querySelector(".time_mm").getAttribute("val");hlCalendar.listener.value=(a.length<2?"0":"")+a+(b.length<2?":0":":")+b,cancelDateEdit()}function gearTouchStart(a){a.preventDefault();for(var b=a.target;;){if(b.classList.contains("gear"))break;b=b.parentElement}b["old_"+b.id]=a.targetTouches[0].screenY,b["o_t_"+b.id]=(new Date).getTime(),b.style.top?/em/.test(b.style.top)?b["o_d_"+b.id]=parseFloat(b.style.top.replace(/em/g,"")):/px/.test(b.style.top)?b["o_d_"+b.id]=18*parseFloat(b.style.top.replace(/px/g,""))/b.clientHeight:b["o_d_"+b.id]=0:b["o_d_"+b.id]=0}function gearTouchMove(a){a.preventDefault();for(var b=a.target;;){if(b.classList.contains("gear"))break;b=b.parentElement}b["new_"+b.id]=a.targetTouches[0].screenY,b["n_t_"+b.id]=(new Date).getTime();var c=18*(b["new_"+b.id]-b["old_"+b.id])/370;b["pos_"+b.id]=b["o_d_"+b.id]+c,b.style.top=b["pos_"+b.id]+"em"}function gearTouchEnd(a){a.preventDefault();for(var b=a.target;;){if(b.classList.contains("gear"))break;b=b.parentElement}var c=(b["new_"+b.id]-b["old_"+b.id])/(b["n_t_"+b.id]-b["o_t_"+b.id]);Math.abs(c)<=.2?b["spd_"+b.id]=0>c?-.08:.08:Math.abs(c)<=.5?b["spd_"+b.id]=0>c?-.16:.16:b["spd_"+b.id]=c/2,b["pos_"+b.id]||(b["pos_"+b.id]=0),rollGear(b)}function rollGear(a){var b=0;clearInterval(a["int_"+a.id]),a["int_"+a.id]=setInterval(function(){var c=a["pos_"+a.id],d=a["spd_"+a.id]*Math.exp(-.03*b);if(c+=d,Math.abs(d)>.05);else{d=.05;var e=2*Math.round(c/2);if(Math.abs(c-e)<.02)return setGear(a),void clearInterval(a["int_"+a.id]);c>e?c-=d:c+=d}a.style.top=c+"em",a["pos_"+a.id]=c,setGear(a),b++},30)}function setGear(a){var b=a["pos_"+a.id];b>8&&(b=8,clearInterval(a["int_"+a.id]));var c=parseFloat(a.getAttribute("val"));switch(a.dataset.datetype){case"date_yy":var d=8-2*(passY-1);d>b&&(b=d,clearInterval(a["int_"+a.id])),c=Math.abs(b-8)/2;break;case"date_mm":-14>b&&(b=-14,clearInterval(a["int_"+a.id])),c=Math.abs(b-8)/2;break;case"date_dd":var e=hlCalendar.gearDate.querySelector(".date_yy"),f=hlCalendar.gearDate.querySelector(".date_mm"),g=parseInt(e.getAttribute("val")),h=parseInt(f.getAttribute("val")),i=calcDays(g,h),d=8-2*(i-1);d>b&&(b=d,clearInterval(a["int_"+a.id])),c=Math.abs(b-8)/2;break;case"time_hh":-38>b&&(b=-38,clearInterval(a["int_"+a.id])),c=Math.abs(b-8)/2;break;case"time_mm":-110>b&&(b=-110,clearInterval(a["int_"+a.id])),c=Math.abs(b-8)/2}a.setAttribute("val",c),/date/.test(a.dataset.datetype)?setDateGear():setTimeGear(hlCalendar.gearDate)}var hlCalendar={params:{minY:1900,minM:1,minD:1,maxY:2099,maxM:12,maxD:31}},passY=hlCalendar.params.maxY-hlCalendar.params.minY+1;
/*! 最后修改于： 2016-01-18  04:38:31 */